--@author gaspard
--@version 1.0.1
--@provides [nomain] .

-- TEMPLATE IN SCRIPT:
--package.path = package.path .. ';' .. reaper.GetResourcePath()..'/Scripts/Gaspard ReaScripts/Libraries' .. '/?.lua'
--local KEYS = require('KEYBOARD')
--
--or
--
--local KEYS = dofile(reaper.GetResourcePath().."Scripts/Gaspard ReaScripts/Libraries/KEYBOARD.lua")

local keys = {}

local _ISMAC = (reaper.GetOS():match("OSX") ~= nil)

local _KEYS = {}
local _KEYS_CUTOFF = -2
-- taken from here https://forums.cockos.com/showpost.php?p=2608321&postcount=12
keys.CODES = {
  LBUTTON     = 0x01, --  The left mouse button
  RBUTTON     = 0x02, --  The right mouse button
  CANCEL      = 0x03, --  The Cancel virtual key, used for control-break processing
  MBUTTON     = 0x04, --  The middle mouse button
  BACK        = 0x08, --  Backspace
  TAB         = 0x09, --  Tab
  CLEAR       = 0x0C, --  5 (keypad without Num Lock)
  ENTER       = 0x0D, --  Enter
  SHIFT       = 0x10, --  Shift (either one)
  CONTROL     = 0x11, --  Ctrl (either one) CMD in mac
  ALT         = 0x12, --  Alt (either one)
  PAUSE       = 0x13, --  Pause
  CAPITAL     = 0x14, --  Caps Lock
  ESCAPE      = 0x1B, --  Esc
  SPACE       = 0x20, --  Spacebar
  PAGEUP      = 0x21, --  Page Up
  PAGEDOWN    = 0x22, --  Page Down
  END         = 0x23, --  End
  HOME        = 0x24, --  Home
  LEFT        = 0x25, --  Left Arrow
  UP          = 0x26, --  Up Arrow
  RIGHT       = 0x27, --  Right Arrow
  DOWN        = 0x28, --  Down Arrow
  SELECT      = 0x29, --  Select
  PRINT       = 0x2A, --  Print (only used by Nokia keyboards)
  EXECUTE     = 0x2B, --  Execute (not used)
  SNAPSHOT    = 0x2C, --  Print Screen
  INSERT      = 0x2D, --  Insert
  DELETE      = 0x2E, --  Delete
  HELP        = 0x2F, --  Help
  ['0']       = 0x30, --  0
  ['1']       = 0x31, --  1
  ['2']       = 0x32, --  2
  ['3']       = 0x33, --  3
  ['4']       = 0x34, --  4
  ['5']       = 0x35, --  5
  ['6']       = 0x36, --  6
  ['7']       = 0x37, --  7
  ['8']       = 0x38, --  8
  ['9']       = 0x39, --  9
  A           = 0x41, --  A
  B           = 0x42, --  B
  C           = 0x43, --  C
  D           = 0x44, --  D
  E           = 0x45, --  E
  F           = 0x46, --  F
  G           = 0x47, --  G
  H           = 0x48, --  H
  I           = 0x49, --  I
  J           = 0x4A, --  J
  K           = 0x4B, --  K
  L           = 0x4C, --  L
  M           = 0x4D, --  M
  N           = 0x4E, --  N
  O           = 0x4F, --  O
  P           = 0x50, --  P
  Q           = 0x51, --  Q
  R           = 0x52, --  R
  S           = 0x53, --  S
  T           = 0x54, --  T
  U           = 0x55, --  U
  V           = 0x56, --  V
  W           = 0x57, --  W
  X           = 0x58, --  X
  Y           = 0x59, --  Y
  Z           = 0x5A, --  Z
  STARTKEY    = 0x5B, --  Start Menu key (ctrl in macos)
  CONTEXTKEY  = 0x5D, --  Context Menu key
  NUMPAD0     = 0x60, --  0 (keypad with Num Lock)
  NUMPAD1     = 0x61, --  1 (keypad with Num Lock)
  NUMPAD2     = 0x62, --  2 (keypad with Num Lock)
  NUMPAD3     = 0x63, --  3 (keypad with Num Lock)
  NUMPAD4     = 0x64, --  4 (keypad with Num Lock)
  NUMPAD5     = 0x65, --  5 (keypad with Num Lock)
  NUMPAD6     = 0x66, --  6 (keypad with Num Lock)
  NUMPAD7     = 0x67, --  7 (keypad with Num Lock)
  NUMPAD8     = 0x68, --  8 (keypad with Num Lock)
  NUMPAD9     = 0x69, --  9 (keypad with Num Lock)
  MULTIPLY    = 0x6A, --  * (keypad)
  ADD         = 0x6B, --  = 0x(keypad)
  SEPARATOR   = 0x6C, --  Separator (never generated by the keyboard)
  SUBTRACT    = 0x6D, --  - (keypad)
  DECIMAL     = 0x6E, --  . (keypad with Num Lock)
  DIVIDE      = 0x6F, --  / (keypad)
  F1          = 0x70, --  F1
  F2          = 0x71, --  F2
  F3          = 0x72, --  F3
  F4          = 0x73, --  F4
  F5          = 0x74, --  F5
  F6          = 0x75, --  F6
  F7          = 0x76, --  F7
  F8          = 0x77, --  F8
  F9          = 0x78, --  F9
  F10         = 0x79, --  F10
  F11         = 0x7A, --  F11
  F12         = 0x7B, --  F12
  F13         = 0x7C, --  F13
  F14         = 0x7D, --  F14
  F15         = 0x7E, --  F15
  F16         = 0x7F, --  F16
  F17         = 0x80, --  F17
  F18         = 0x81, --  F18
  F19         = 0x82, --  F19
  F20         = 0x83, --  F20
  F21         = 0x84, --  F21
  F22         = 0x85, --  F22
  F23         = 0x86, --  F23
  F24         = 0x87, --  F24
  NUMLOCK     = 0x90, --  Num Lock
  OEM_SCROLL  = 0x91, --  Scroll Lock
  OEM_1       = 0xBA, --  ;
  OEM_PLUS    = 0xBB, --  =
  OEM_COMMA   = 0xBC, --  ,
  OEM_MINUS   = 0xBD, --  -
  OEM_PERIOD  = 0xBE, --  .
  OEM_2       = 0xBF, --  /
  OEM_3       = 0xC0, --  `
  OEM_4       = 0xDB, --  [
  OEM_5       = 0xDC, --  \
  OEM_6       = 0xDD, --  ]
  OEM_7       = 0xDE, --  '
  OEM_8       = 0xDF, --  (unknown)
  ICO_F17     = 0xE0, --  F17 on Olivetti extended keyboard (internal use only)
  ICO_F18     = 0xE1, --  F18 on Olivetti extended keyboard (internal use only)
  OEM_102     = 0xE2, --  < or | on IBM-compatible 102 enhanced non-U.S. keyboard
  ICO_HELP    = 0xE3, --  Help on Olivetti extended keyboard (internal use only)
  ICO_00      = 0xE4, --  00 on Olivetti extended keyboard (internal use only)
  ICO_CLEAR   = 0xE6, --  Clear on Olivette extended keyboard (internal use only)
  OEM_RESET   = 0xE9, --  Reset (Nokia keyboards only)
  OEM_JUMP    = 0xEA, --  Jump (Nokia keyboards only)
  OEM_PA1     = 0xEB, --  PA1 (Nokia keyboards only)
  OEM_PA2     = 0xEC, --  PA2 (Nokia keyboards only)
  OEM_PA3     = 0xED, --  PA3 (Nokia keyboards only)
  OEM_WSCTRL  = 0xEE, --  WSCTRL (Nokia keyboards only)
  OEM_CUSEL   = 0xEF, --  CUSEL (Nokia keyboards only)
  OEM_ATTN    = 0xF0, --  ATTN (Nokia keyboards only)
  OEM_FINNISH = 0xF1, --  FINNISH (Nokia keyboards only)
  OEM_COPY    = 0xF2, --  COPY (Nokia keyboards only)
  OEM_AUTO    = 0xF3, --  AUTO (Nokia keyboards only)
  OEM_ENLW    = 0xF4, --  ENLW (Nokia keyboards only)
  OEM_BACKTAB = 0xF5, --  BACKTAB (Nokia keyboards only)
  ATTN        = 0xF6, --  ATTN
  CRSEL       = 0xF7, --  CRSEL
  EXSEL       = 0xF8, --  EXSEL
  EREOF       = 0xF9, --  EREOF
  PLAY        = 0xFA, --  PLAY
  ZOOM        = 0xFB, --  ZOOM
  NONAME      = 0xFC, --  NONAME
  PA1         = 0xFD, --  PA1
  OEM_CLEAR   = 0xFE, --  CLEAR
}

keys.CODE_NAMES = {
  [keys.CODES.LBUTTON]     = 'Left Mouse Button',
  [keys.CODES.RBUTTON]     = 'Right Mouse Button',
  [keys.CODES.CANCEL]      = 'Cancel',
  [keys.CODES.MBUTTON]     = 'Middle Mouse Button',
  [keys.CODES.BACK]        = 'Backspace',
  [keys.CODES.TAB]         = 'Tab',
  [keys.CODES.CLEAR]       = 'Clear',
  [keys.CODES.ENTER]       = 'Enter',
  [keys.CODES.SHIFT]       = 'Shift',
  [keys.CODES.CONTROL]     = _ISMAC and 'Command' or 'Control',
  [keys.CODES.ALT]         = _ISMAC and 'Option' or 'Alt',
  [keys.CODES.PAUSE]       = 'Pause',
  [keys.CODES.CAPITAL]     = 'Caps Lock',
  [keys.CODES.ESCAPE]      = 'Escape',
  [keys.CODES.SPACE]       = 'Spacebar',
  [keys.CODES.PAGEUP]      = 'Page Up',
  [keys.CODES.PAGEDOWN]    = 'Page Down',
  [keys.CODES.END]         = 'End',
  [keys.CODES.HOME]        = 'Home',
  [keys.CODES.LEFT]        = 'Left Arrow',
  [keys.CODES.UP]          = 'Up Arrow',
  [keys.CODES.RIGHT]       = 'Right Arrow',
  [keys.CODES.DOWN]        = 'Down Arrow',
  [keys.CODES.SELECT]      = 'Select',
  [keys.CODES.PRINT]       = 'Print',
  [keys.CODES.EXECUTE]     = 'Execute',
  [keys.CODES.SNAPSHOT]    = 'Print Screen',
  [keys.CODES.INSERT]      = 'Insert',
  [keys.CODES.DELETE]      = 'Delete',
  [keys.CODES.HELP]        = 'Help',
  [keys.CODES['0']]        = '0',
  [keys.CODES['1']]        = '1',
  [keys.CODES['2']]        = '2',
  [keys.CODES['3']]        = '3',
  [keys.CODES['4']]        = '4',
  [keys.CODES['5']]        = '5',
  [keys.CODES['6']]        = '6',
  [keys.CODES['7']]        = '7',
  [keys.CODES['8']]        = '8',
  [keys.CODES['9']]        = '9',
  [keys.CODES.A]           = 'A',
  [keys.CODES.B]           = 'B',
  [keys.CODES.C]           = 'C',
  [keys.CODES.D]           = 'D',
  [keys.CODES.E]           = 'E',
  [keys.CODES.F]           = 'F',
  [keys.CODES.G]           = 'G',
  [keys.CODES.H]           = 'H',
  [keys.CODES.I]           = 'I',
  [keys.CODES.J]           = 'J',
  [keys.CODES.K]           = 'K',
  [keys.CODES.L]           = 'L',
  [keys.CODES.M]           = 'M',
  [keys.CODES.N]           = 'N',
  [keys.CODES.O]           = 'O',
  [keys.CODES.P]           = 'P',
  [keys.CODES.Q]           = 'Q',
  [keys.CODES.R]           = 'R',
  [keys.CODES.S]           = 'S',
  [keys.CODES.T]           = 'T',
  [keys.CODES.U]           = 'U',
  [keys.CODES.V]           = 'V',
  [keys.CODES.W]           = 'W',
  [keys.CODES.X]           = 'X',
  [keys.CODES.Y]           = 'Y',
  [keys.CODES.Z]           = 'Z',
  [keys.CODES.STARTKEY]    = _ISMAC and 'Control' or 'Start Menu',
  [keys.CODES.CONTEXTKEY]  = 'Context Menu',
  [keys.CODES.NUMPAD0]     = 'Numpad 0',
  [keys.CODES.NUMPAD1]     = 'Numpad 1',
  [keys.CODES.NUMPAD2]     = 'Numpad 2',
  [keys.CODES.NUMPAD3]     = 'Numpad 3',
  [keys.CODES.NUMPAD4]     = 'Numpad 4',
  [keys.CODES.NUMPAD5]     = 'Numpad 5',
  [keys.CODES.NUMPAD6]     = 'Numpad 6',
  [keys.CODES.NUMPAD7]     = 'Numpad 7',
  [keys.CODES.NUMPAD8]     = 'Numpad 8',
  [keys.CODES.NUMPAD9]     = 'Numpad 9',
  [keys.CODES.MULTIPLY]    = 'Numpad *',
  [keys.CODES.ADD]         = 'Numpad +',
  [keys.CODES.SEPARATOR]   = 'Separator',
  [keys.CODES.SUBTRACT]    = 'Numpad -',
  [keys.CODES.DECIMAL]     = 'Numpad .',
  [keys.CODES.DIVIDE]      = 'Numpad /',
  [keys.CODES.F1]          = 'F1',
  [keys.CODES.F2]          = 'F2',
  [keys.CODES.F3]          = 'F3',
  [keys.CODES.F4]          = 'F4',
  [keys.CODES.F5]          = 'F5',
  [keys.CODES.F6]          = 'F6',
  [keys.CODES.F7]          = 'F7',
  [keys.CODES.F8]          = 'F8',
  [keys.CODES.F9]          = 'F9',
  [keys.CODES.F10]         = 'F10',
  [keys.CODES.F11]         = 'F11',
  [keys.CODES.F12]         = 'F12',
  [keys.CODES.F13]         = 'F13',
  [keys.CODES.F14]         = 'F14',
  [keys.CODES.F15]         = 'F15',
  [keys.CODES.F16]         = 'F16',
  [keys.CODES.F17]         = 'F17',
  [keys.CODES.F18]         = 'F18',
  [keys.CODES.F19]         = 'F19',
  [keys.CODES.F20]         = 'F20',
  [keys.CODES.F21]         = 'F21',
  [keys.CODES.F22]         = 'F22',
  [keys.CODES.F23]         = 'F23',
  [keys.CODES.F24]         = 'F24',
  [keys.CODES.NUMLOCK]     = 'Num Lock',
  [keys.CODES.OEM_SCROLL]  = 'Scroll Lock',
  [keys.CODES.OEM_1]       = ';',
  [keys.CODES.OEM_PLUS]    = '=',
  [keys.CODES.OEM_COMMA]   = ',',
  [keys.CODES.OEM_MINUS]   = '-',
  [keys.CODES.OEM_PERIOD]  = '.',
  [keys.CODES.OEM_2]       = '/',
  [keys.CODES.OEM_3]       = '`',
  [keys.CODES.OEM_4]       = '[',
  [keys.CODES.OEM_5]       = '\\',
  [keys.CODES.OEM_6]       = ']',
  [keys.CODES.OEM_7]       = "'",
  [keys.CODES.OEM_8]       = '(unknown)',
  [keys.CODES.ICO_F17]     = 'F17 (Olivetti extended keyboard)',
  [keys.CODES.ICO_F18]     = 'F18 (Olivetti extended keyboard)',
  [keys.CODES.OEM_102]     = '< or | (IBM-compatible 102 enhanced non-U.S. keyboard)',
  [keys.CODES.ICO_HELP]    = 'Help (Olivetti extended keyboard)',
  [keys.CODES.ICO_00]      = '00 (Olivetti extended keyboard)',
  [keys.CODES.ICO_CLEAR]   = 'Clear (Olivetti extended keyboard)',
  [keys.CODES.OEM_RESET]   = 'Reset (Nokia keyboards only)',
  [keys.CODES.OEM_JUMP]    = 'Jump (Nokia keyboards only)',
  [keys.CODES.OEM_PA1]     = 'PA1 (Nokia keyboards only)',
  [keys.CODES.OEM_PA2]     = 'PA2 (Nokia keyboards only)',
  [keys.CODES.OEM_PA3]     = 'PA3 (Nokia keyboards only)',
  [keys.CODES.OEM_WSCTRL]  = 'WSCTRL (Nokia keyboards only)',
  [keys.CODES.OEM_CUSEL]   = 'CUSEL (Nokia keyboards only)',
  [keys.CODES.OEM_ATTN]    = 'ATTN (Nokia keyboards only)',
  [keys.CODES.OEM_FINNISH] = 'FINNISH (Nokia keyboards only)',
  [keys.CODES.OEM_COPY]    = 'COPY (Nokia keyboards only)',
  [keys.CODES.OEM_AUTO]    = 'AUTO (Nokia keyboards only)',
  [keys.CODES.OEM_ENLW]    = 'ENLW (Nokia keyboards only)',
  [keys.CODES.OEM_BACKTAB] = 'BACKTAB (Nokia keyboards only)',
  [keys.CODES.ATTN]        = 'ATTN',
  [keys.CODES.CRSEL]       = 'CRSEL',
  [keys.CODES.EXSEL]       = 'EXSEL',
  [keys.CODES.EREOF]       = 'EREOF',
  [keys.CODES.PLAY]        = 'PLAY',
  [keys.CODES.ZOOM]        = 'ZOOM',
  [keys.CODES.NONAME]      = 'NONAME',
  [keys.CODES.PA1]         = 'PA1',
  [keys.CODES.OEM_CLEAR]   = 'CLEAR',
}

keys.IsPressed = function(key, cutoff)
    if key == nil or key == -1 then return false end
    if reaper.JS_VKeys_GetState(cutoff or _KEYS_CUTOFF):byte(key) ~= 0 then
        if _KEYS[key] == nil then
            _KEYS[key] = true
            return true
        end
    else
        if _KEYS[key] then
            _KEYS[key] = nil
        end
    end
    return false
end

return keys
